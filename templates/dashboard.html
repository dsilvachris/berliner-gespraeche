{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>📊 Dashboard - Sag doch mal, Berlin</h1>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; text-align: center;">
            <h3>👥 Gesprächspartner</h3>
            <div style="font-size: 36px; font-weight: bold; color: #1976d2;">{{ data.total_partners }}</div>
            <p>Personen</p>
        </div>
        
        <div style="background: #f3e5f5; padding: 20px; border-radius: 10px; text-align: center;">
            <h3>⏱️ Gesamtdauer</h3>
            <div style="font-size: 36px; font-weight: bold; color: #7b1fa2;">{{ data.total_duration }}</div>
            <p>Minuten</p>
        </div>
        
        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; text-align: center;">
            <h3>💬 Dialoge</h3>
            <div style="font-size: 36px; font-weight: bold; color: #388e3c;">{{ dialogues|length }}</div>
            <p>Gespräche</p>
        </div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 40px 0;">
        <div>
            <h3>🏷️ Diskutierte Themen</h3>
            <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; text-align: center;">
                {% if data.topics %}
                    <canvas id="topicsChart" width="300" height="300"></canvas>
                {% else %}
                    <p style="color: #666;">Noch keine Themen diskutiert</p>
                {% endif %}
            </div>
        </div>
        
        <div>
            <h3>🗺️ Bezirke</h3>
            <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; text-align: center;">
                {% if data.districts %}
                    <canvas id="districtsChart" width="300" height="300"></canvas>
                {% else %}
                    <p style="color: #666;">Noch keine Bezirke erfasst</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div style="margin: 40px 0;">
        <h3>📝 Letzte Dialoge</h3>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; max-height: 400px; overflow-y: auto;">
            {% if dialogues %}
                {% for dialogue in dialogues[:10] %}
                <div style="background: white; margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>{{ dialogue.district or 'Unbekannter Bezirk' }}</strong>
                        <small style="color: #666;">{{ dialogue.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                    </div>
                    <p style="margin: 5px 0;"><strong>Themen:</strong> {{ dialogue.topics|join(', ') or 'Keine Themen' }}</p>
                    <p style="margin: 5px 0;"><strong>Dauer:</strong> {{ dialogue.duration }} Min | <strong>Personen:</strong> {{ dialogue.num_people }}</p>
                    {% if dialogue.notes %}
                    <p style="margin: 5px 0; font-style: italic;">"{{ dialogue.notes }}"</p>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #666; text-align: center;">Noch keine Dialoge dokumentiert</p>
            {% endif %}
        </div>
    </div>
    
    <div style="margin: 40px 0;">
        <h3>📤 Daten exportieren</h3>
        <div style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center;">
            <p style="margin-bottom: 20px;">Alle Dialogdaten herunterladen:</p>
            <a href="{{ url_for('export_excel') }}" class="btn" style="margin: 0 10px; background: #4CAF50;">📊 Excel (.xlsx)</a>
            <a href="{{ url_for('export_csv') }}" class="btn" style="margin: 0 10px; background: #2196F3;">📄 CSV (.csv)</a>
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 40px;">
        <a href="{{ url_for('index') }}" class="btn">🏠 Zur Startseite</a>
        <a href="{{ url_for('start_dialogue') }}" class="btn btn-secondary">💬 Neuen Dialog starten</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
{% if data.topics %}
// Topics Pie Chart
const topicsCtx = document.getElementById('topicsChart').getContext('2d');
new Chart(topicsCtx, {
    type: 'pie',
    data: {
        labels: {{ data.topics.keys() | list | tojson }},
        datasets: [{
            data: {{ data.topics.values() | list | tojson }},
            backgroundColor: [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
{% endif %}

{% if data.districts %}
// Districts Pie Chart
const districtsCtx = document.getElementById('districtsChart').getContext('2d');
new Chart(districtsCtx, {
    type: 'pie',
    data: {
        labels: {{ data.districts.keys() | list | tojson }},
        datasets: [{
            data: {{ data.districts.values() | list | tojson }},
            backgroundColor: [
                '#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
{% endif %}
</script>
{% endblock %}